<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Server Options and Setup - Mimosa</title>
  <meta name="description" content="Mimosa can serve your assets for you or start your server.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="css/main.css"> -->
  <link rel="stylesheet" href="css/bootstrap.min.css" >
  <link rel="stylesheet" href="css/bootstrap-responsive.min.css" >
  <link rel="stylesheet" href="css/app.css">

  <link rel="shortcut icon" href="img/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-57-precomposed.png">
</head>
<body data-spy="scroll" data-target=".subnav" data-offset="50">

  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <div class="nav-collapse collapse">
          <ul class="nav">
            <li class="">
              <a href="./index.html">Mimosa</a>
            </li>
            <li class="">
              <a href="./started.html">Get Started</a>
            </li>
            <li class="">
              <a href="./commands.html">Commands</a>
            </li>
            <li class="">
              <a href="./compilers.html">Compilers</a>
            </li>
            <li  class="">
              <a href="./modules.html">Modules</a>
            </li>
            <li class="active">
              <a href="./server.html">Serve</a>
            </li>
            <li class="">
              <a href="./utilities.html">Utilities</a>
            </li>
            <li class="">
              <a href="./optimization.html">Optimization</a>
            </li>
            <li class="">
              <a href="./configuration.html">Configuration</a>
            </li>
            <li class="">
              <a href="./about.html">About/FAQ</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

<div class="container main">

  <header class="jumbotron subhead" id="overview">
    <h1>Server Resources</h1>
    <p class="lead">Mimosa jump starts and integrates your server development </p>
    <div class="subnav">
      <ul class="nav nav-pills">
        <li><a href="#overview" title="How Mimosa's server resources work">Overview</a></li>
        <li><a href="#new" title="What Mimosa delivers">Via 'mimosa new'</a></li>
        <li><a href="#mimosas" title="Mimosa's embedded server">Mimosa's Server</a></li>
        <li><a href="#yours" title="How Mimosa invokes your server">Your Server</a></li>
        <li><a href="#views" title="View options">Views</a></li>
      </ul>
    </div>
  </header>

  <section class="command-list server-list">
    <section id="overview">
      <div class="page-header">
        <h1>
          Overview
          <small><span class="options"></span></small>
        </h1>
      </div>
    </section>

    <p>Mimosa's server support comes courtesy of the <code class="option">mimosa-server</code> module. As such, it belongs to a codebase apart from the Mimosa core, and it behaves according to the rules of any <a href="./modules.html">Mimosa module</a>, so it can be removed and added.</p>

    <h2>No server necessary</h2>
    <p>With <code class="option">mimosa watch</code> Mimosa does not need to serve assets. A project might have a server already. <code class="option">mimosa watch</code> is good with that. It'll run the workflow, compile code, lint it, write it, and stop there.</p>

    <h2>But if you want one...</h2>
    <p>Toss a <code class="option">-s/--server</code> onto <code class="option">mimosa watch</code> and Mimosa will invoke a server. Which server Mimosa invokes depends on what is in the <code class="option">mimosa-config</code>. Mimosa could start its own embedded Express server and point it at a project's views and assets. Or Mimosa could start the server provided by <code class="option">mimosa new</code>. Or Mimosa could execute an existing server using a simple exports hook.</p>

    <p>All options are nodejs-based. Mimosa does not have the ability to start your Rails server or your Tomcat.</p>

    <section id="new">
      <div class="page-header">
        <h1>
          Mimosa Delivered Server Assets
          <small><span class="options">what 'mimosa new' gives you</span></small>
        </h1>
      </div>
    </section>

    <h2>Server</h2>

    <p><code class="option">mimosa new</code> provides the option to have a server or to use Mimosa's embedded server. If no server is chosen, Mimosa will not deliver any sort of server code.</p>

    <p>If the Express option is chosen, Mimosa will provide a single file, written in the chosen JavaScript meta-language, that Mimosa will use to start your server. Mimosa also provides a simple router, also in the JavaScript meta-language you chose.</p>

    <h2>Views</h2>

    <p><code class="option">mimosa new</code> provides the option to select a server view technology. Plain HTML is an option as well as a number of dynamic templating technologies. Depending on the technology chosen, Mimosa will provide one or two view templates for the starter app.</p>

    <section id="mimosas">
      <div class="page-header">
        <h1>
          Mimosa's Embedded Server
          <small><span class="options">mimosa can serve your app</span></small>
        </h1>
      </div>
    </section>

    <p>Mimosa comes bundled with its own Express server. If <code class="option">server.defaultServer.enabled</code> is set to <code class="option">true</code> in the <code class="option">mimosa-config</code>, then when <code class="option">mimosa watch</code> is run with the <code class="option">--server</code> flag, Mimosa will run its embedded server. When running Mimosa's Express, all of the settings in the <code class="option">server</code> portion of the <code class="option">mimosa-config</code> become very important. See the <a href="./configuration.html#server">server configuration details</a> to learn more.</p>

    <p>Mimosa's Express will do a few things in addition to serving up an application. Assuming <code class="option">liveReload.enabled</code> is set to <code class="option">true</code> (default), Live Reload will be used. Mimosa will reload the browser whenever a file in <code class="option">liveReload.additionalDirs</code> (default 'views') or <code class="option">config.watch.compiledDir</code> (default 'public') changes. Mimosa will also serve static assets gzipped.</p>

    <h2>Routing</h2>

    <p>How Mimosa routes a project's paths depends on the setting for <code class="option">server.defaultServer.onePager</code>.</p>

    <p>When <code class="option">onePager</code> is set to <code class="option">true</code> the embedded Express server is configured to automatically route every request to the application's <code class="option">index</code> view that doesn't result in an asset being returned. For instance given a URL of<code class="option">/account/1/item/2/comment/4</code> Mimosa's embedded server will route the request to the index view and leave the handling of the complex URL to the client code.</p>

    <p>When <code class="option">onePager</code> is set to <code class="option">false</code>, Mimosa will assume simple routes for the application. <code class="option">url:3000/</code> will still route to the <code class="option">index</code> view. But<code class="option">url:3000/foo/</code> will route to the <code class="option">foo</code> view as will <code class="option">url:3000/foo/bar/b az</code>.</p>

    <section id="yours">
      <div class="page-header">
        <h1>
          Hooked Into Your Server
          <small><span class="options">mimosa can start your app</span></small>
        </h1>
      </div>
    </section>

    <p>Mimosa can start a nodejs based server. If <code class="option">server.defaultServer.enabled</code> is set to <code class="option">false</code>, Mimosa will look for a piece of node.js code located at <code class="option">server.path</code>, and execute the <code class="option">startServer</code> function of that code (so that function must be exported). That function will be passed the entire resolved and enriched <code class="option">mimosa-config</code>.</p>

    <p>The <code class="option">startServer</code> function is also passed a callback that must be executed for Mimosa to continue through its workflows. If using Mimosa's live reload functionality is being used, the callback should be provided node's http server object as a first parameter.  That happens to be the object returned by Express's <code class="option">app.listen()</code> function. If socket.io is being used, then the callback should be provided the  socket.io object as a second parameter. See the <a href="./utilities.html#reload">Live Reload section</a> on the Utilities page for more details.</p>

    <p>The server code delivered by <code class="option">mimosa new</code> will use all of the configuration from the <code class="option">mimosa-config</code> <code class="option">server</code> block. The use of the <code class="option">mimosa-config</code> entries could be removed from the delivered code. For instance, in the following code, all of the bolded entries could be replaced with their actual values, but this of course means Mimosa will be less capable of controlling behavior an app.</p>

<pre>app.configure ->
  app.set 'port', <b>config.server.port</b>
  app.set 'views', <b>config.server.views.path</b>
  app.engine <b>config.server.views.extension</b>, engines[<b>config.server.views.compileWith</b>]
  app.set 'view engine', <b>config.server.views.extension</b></pre>

    <section id="views">
      <div class="page-header">
        <h1>
          Server Views
          <small><span class="options">you've got a few options</span></small>
        </h1>
      </div>
    </section>

    <p>As with the server code Mimosa delivers, the view code and routes are built to be flexible enough to work in several scenarios. Some conditionals and <code class="option">mimosa-config</code> properties can be replaced or hard-coded. The code may not need that level of complexity.</p>

    <p>Mimosa uses <a href="https://github.com/visionmedia/consolidate.js">consolidate</a>, both internally and within the delivered Express, to easily toggle between different view templating libraries. Also installed will be the library for the chosen templating library.</p>

    <p><code class="option">server.views.compileWith</code> can be configured to use one of the available libraries, and each library has a default extension. When a client library is chosen during <code class="option">mimosa new</code>, Mimosa will modify the <code class="option">mimosa-config</code> with these values. The <code class="option">server.views.compileWith</code> values are listed below next to the name of each technology. The default extensions are listed as well.</p>

    <h2>Jade <small><span class="mim">jade</span> <span class="command">.jade</span></small></h2>
    <p><a href="http://jade-lang.com/">Jade</a> is available. The project that <code class="option">mimosa new</code> delivers will include simple layout and index pages.</p>

    <h2>EJS <small><span class="mim">ejs</span> <span class="command">.ejs</span></small></h2>
    <p><a href="https://github.com/visionmedia/ejs">EJS</a> is also available, and <code class="option">mimosa new</code> delivers a single <code class="option">index.ejs</code> file.</p>

    <h2>Hogan <small><span class="mim">hogan</span> <span class="command">.hjs</span></small></h2>
    <p><a href="http://twitter.github.com/hogan.js/">Hogan</a> is available, and <code class="option">mimosa new</code> delivers a single <code class="option">index.hjs</code> file.</p>

    <h2>Handlebars <small><span class="mim">handlebars</span> <span class="command">.hbs</span></small></h2>
    <p><a href="http://handlebarsjs.com/">Handlebars</a> is available, and <code class="option">mimosa new</code> delivers a single <code class="option">index.hbs</code> file.</p>

    <h2>Dust <small><span class="mim">dust</span> <span class="command">.dust</span></small></h2>
    <p><a href="http://linkedin.github.io/dustjs/">Dust</a> is available, and <code class="option">mimosa new</code> delivers a single <code class="option">index.dust</code> file.</p>

    <h2>HTML <small><span class="mim">html</span> <span class="command">.html</span></small></h2>
    <p>Plain HTML templates can be chosen too. Mimosa uses <a href="https://github.com/visionmedia/ejs">EJS</a> behind the scenes (see above), as EJS allows plain HTML pages. To accommodate the fact that plain HTML isn't dynamic, if plain HTML templating is chosen, <code class="option">mimosa new</code> provides two templates, one each for running with and without the <code class="option">optimize</code> flag. The Express routes know how to toggle between the two. Also, the delivered server has a switch in its options for Live Reload that will allow plain HTML pages to work just fine, so not having that dynamic toggle in a view will not cause any trouble.</p>

  </section>

</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.7.2.min.js"><\/script>')</script>
<script src="js/vendor/bootstrap-collapse.js"></script>
<script src="js/vendor/bootstrap-scrollspy.js"></script>

<!-- scripts concatenated and minified via build script -->
<script src="js/plugins.js"></script>
<script src="js/main.js"></script>
<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
<!-- end scripts -->

<script>
    var _gaq=[['_setAccount','UA-33737130-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>
